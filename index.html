<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Lightning Editor | ProVoid</title>
    <style type="text/css">
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&display=swap');

        :root {
            --bg-color: #080808;
            --text-color: #f0f0f0;
            --accent-color: #ffffff;
            --hover-color: #1a1a1a;
            --border-color: #222222;
            --secondary-bg: #0d0d0d;
            --secondary-text: #808080;
            --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius-md: 8px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            width: 100%; height: 100vh;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
        }

        #main-container {
            display: flex; flex-direction: column;
            height: 100%;
            background: radial-gradient(circle at top right, #111, #080808);
        }

        /* --- Tab Bar Styling --- */
        #tab-bar {
            height: 54px;
            display: flex; align-items: center;
            padding: 0 15px;
            gap: 8px;
            background: rgba(10, 10, 10, 0.95);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .tab {
            height: 36px; min-width: 130px;
            padding: 0 14px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            display: flex; align-items: center; justify-content: space-between;
            cursor: grab; transition: all 0.3s var(--transition-smooth);
            font-size: 13px; color: var(--secondary-text);
            user-select: none;
        }

        .tab:active { cursor: grabbing; }

        .tab.active {
            background: linear-gradient(145deg, #222, #111);
            border-color: #666;
            color: var(--text-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        .tab.dragging { opacity: 0.4; border: 1px dashed #fff; }

        .tab-input {
            background: transparent;
            border: none;
            color: white;
            font-family: inherit;
            font-size: 13px;
            width: 80px;
            outline: none;
        }

        .tab-close { 
            opacity: 0.4; margin-left: 10px; font-size: 16px; 
            transition: 0.2s; cursor: pointer;
        }
        .tab-close:hover { color: #ff5555; opacity: 1; }

        #new-tab-btn {
            min-width: 32px; height: 32px;
            border-radius: 8px; border: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; color: var(--secondary-text);
        }
        #new-tab-btn:hover { background: var(--hover-color); color: white; }

        #container { flex-grow: 1; border-top: 1px solid var(--border-color); }

        /* --- Expanded Notifications --- */
        .toast-container {
            position: fixed; bottom: 20px; right: 20px;
            z-index: 9999; display: flex; flex-direction: column-reverse; gap: 8px;
        }

        .toast {
            padding: 10px 18px;
            border-radius: 4px;
            background: #0f0f0f;
            border: 1px solid var(--border-color);
            border-left: 3px solid #fff;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            transform: translateX(140%);
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            font-size: 12px; min-width: 240px;
            display: flex; align-items: center;
        }

        .toast.show { transform: translateX(0); }
        .toast-tag { color: #666; font-weight: bold; margin-right: 10px; font-size: 10px; }
    </style>
</head>
<body>
    <div id="main-container">
        <div class="toast-container" id="toast-container"></div>
        <div id="tab-bar">
            <div id="new-tab-btn">+</div>
        </div>
        <div id="container"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>
    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs' } });

        let editor, activeTab = null, tabs = [];

        function notify(msg, tag = "INFO") {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<span class="toast-tag">${tag}</span> <span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 50);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        function getNextTabName() {
            let i = 1;
            while (true) {
                const name = `Script ${i}`;
                if (!tabs.some(t => t.name === name)) return name;
                i++;
            }
        }

        function createTab(name = null, content = '-- New Lua Script') {
            const finalName = name || getNextTabName();
            const tab = {
                id: Math.random().toString(36).substr(2, 9),
                name: finalName,
                content: content,
                element: document.createElement('div')
            };

            tab.element.className = 'tab';
            tab.element.draggable = true;
            tab.element.innerHTML = `<span class="tab-label">${tab.name}</span><span class="tab-close">Ã—</span>`;
            
            // Reordering logic (Drag and Drop)
            tab.element.addEventListener('dragstart', () => tab.element.classList.add('dragging'));
            tab.element.addEventListener('dragend', () => {
                tab.element.classList.remove('dragging');
                notify("Reordered scripts", "LAYOUT");
            });

            // Click to Activate
            tab.element.onclick = () => activateTab(tab);

            // Double Click to Rename
            tab.element.ondblclick = () => renameTab(tab);

            tab.element.querySelector('.tab-close').onclick = (e) => {
                e.stopPropagation();
                closeTab(tab);
            };

            const btn = document.getElementById('new-tab-btn');
            document.getElementById('tab-bar').insertBefore(tab.element, btn);
            tabs.push(tab);
            activateTab(tab);
            notify(`Created ${finalName}`, "FILESYSTEM");
            return tab;
        }

        function renameTab(tab) {
            const label = tab.element.querySelector('.tab-label');
            const oldName = tab.name;
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'tab-input';
            input.value = oldName;
            
            label.replaceWith(input);
            input.focus();
            input.select();

            const finishRename = () => {
                const newName = input.value.trim() || oldName;
                tab.name = newName;
                const newLabel = document.createElement('span');
                newLabel.className = 'tab-label';
                newLabel.innerText = newName;
                input.replaceWith(newLabel);
                if(newName !== oldName) notify(`Renamed to ${newName}`, "FILESYSTEM");
            };

            input.onblur = finishRename;
            input.onkeydown = (e) => {
                if(e.key === 'Enter') finishRename();
                if(e.key === 'Escape') { input.value = oldName; finishRename(); }
            };
        }

        function activateTab(tab) {
            if (activeTab) {
                activeTab.content = editor.getValue();
                activeTab.element.classList.remove('active');
            }
            activeTab = tab;
            tab.element.classList.add('active');
            if (editor) {
                editor.setValue(tab.content);
                monaco.editor.setModelLanguage(editor.getModel(), "lua");
            }
        }

        function closeTab(tab) {
            if (tabs.length <= 1) return notify("Must have 1 active script", "ERROR");
            tab.element.remove();
            tabs = tabs.filter(t => t.id !== tab.id);
            if (activeTab === tab) activateTab(tabs[tabs.length - 1]);
            notify(`Deleted ${tab.name}`, "FILESYSTEM");
        }

        // Drag over logic for reordering
        const tabBar = document.getElementById('tab-bar');
        tabBar.addEventListener('dragover', e => {
            e.preventDefault();
            const draggingTask = document.querySelector('.dragging');
            const afterElement = getDragAfterElement(tabBar, e.clientX);
            if (afterElement == null) {
                tabBar.insertBefore(draggingTask, document.getElementById('new-tab-btn'));
            } else {
                tabBar.insertBefore(draggingTask, afterElement);
            }
        });

        function getDragAfterElement(container, x) {
            const draggableElements = [...container.querySelectorAll('.tab:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = x - box.left - box.width / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        require(['vs/editor/editor.main'], function() {
            monaco.editor.defineTheme('provoidWhite', {
                base: 'vs-dark',
                inherit: true,
                rules: [],
                colors: {
                    'editor.background': '#080808',
                    'editor.lineHighlightBackground': '#111111',
                    'editorCursor.foreground': '#ffffff',
                    'editorIndentGuide.activeBackground': '#444'
                }
            });

            editor = monaco.editor.create(document.getElementById('container'), {
                theme: 'provoidWhite',
                language: 'lua',
                automaticLayout: true,
                fontSize: 14,
                fontFamily: 'JetBrains Mono',
                minimap: { enabled: true }
            });

            createTab('Main.lua', '-- ProVoid Lightning v2\nprint("System Ready")');
            setTimeout(() => notify("Compiler linked successfully", "PROVOID"), 1000);
        });

        document.getElementById('new-tab-btn').onclick = () => createTab();
    </script>
</body>
</html>

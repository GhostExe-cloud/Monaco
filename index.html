<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>ProVoid Lightning | Ultra</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style type="text/css">
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&display=swap');
        :root {
            --bg-color: #080808;
            --text-color: #f0f0f0;
            --accent-color: #ffffff;
            --hover-color: #1a1a1a;
            --border-color: #222222;
            --secondary-bg: #0d0d0d;
            --secondary-text: #808080;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --birthday-gold: #ffd700;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body, html {
            width: 100%; height: 100%;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #birthday-banner {
            display: none; 
            flex-shrink: 0;
            background: linear-gradient(90deg, #0a0a0a, #1a1600, #0a0a0a);
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            padding: 10px 25px;
            align-items: center;
            justify-content: space-between;
        }
        .bday-text { color: var(--birthday-gold); font-size: 12px; font-weight: 600; text-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .donate-btn {
            background: var(--birthday-gold); color: #000;
            padding: 4px 12px; border-radius: 4px;
            text-decoration: none; font-weight: 800; font-size: 10px;
            text-transform: uppercase; transition: 0.3s;
        }
        .donate-btn:hover { background: #fff; box-shadow: 0 0 15px rgba(255,215,0,0.5); }

        #tab-bar {
            height: 54px; flex-shrink: 0;
            display: flex; align-items: center;
            padding: 0 15px; gap: 8px;
            background: #0a0a0a; border-bottom: 1px solid var(--border-color);
            overflow-x: auto; scrollbar-width: none;
        }
        #tab-bar::-webkit-scrollbar { display: none; }

        .tab {
            height: 36px; min-width: 150px; padding: 0 12px;
            background: var(--secondary-bg); border: 1px solid var(--border-color);
            border-radius: 6px; display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; transition: var(--transition); font-size: 13px; color: var(--secondary-text);
            user-select: none; position: relative;
        }
        .tab.active { background: #1a1a1a; border-color: #444; color: #fff; }
        
        .tab.dirty::after {
            content: ''; position: absolute; top: 5px; left: 5px;
            width: 6px; height: 6px; background: var(--birthday-gold); border-radius: 50%;
        }

        .tab-lbl { flex-grow: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; pointer-events: none; }
        .tab-close { opacity: 0.3; font-size: 16px; margin-left: 8px; width: 15px; text-align: center; }
        .tab-close:hover { color: #ff5555; opacity: 1; }
        
        #new-tab-btn {
            min-width: 34px; height: 34px; border-radius: 6px;
            border: 1px solid var(--border-color); display: flex;
            align-items: center; justify-content: center;
            cursor: pointer; color: var(--secondary-text);
        }
        #new-tab-btn:hover { background: var(--hover-color); color: #fff; }

        #container { flex-grow: 1; width: 100%; }

        .toast-container { position: fixed; bottom: 25px; right: 25px; display: flex; flex-direction: column-reverse; gap: 8px; z-index: 9999; }
        .toast {
            padding: 12px 20px; background: #0f0f0f; border: 1px solid #222;
            border-left: 3px solid var(--accent-color); border-radius: 4px;
            transform: translateX(160%); transition: var(--transition);
            font-size: 11px; min-width: 220px; color: #fff;
        }
        .toast.show { transform: translateX(0); }
    </style>
</head>
<body>

    <div id="birthday-banner">
        <span class="bday-text">‚ú® HAPPY BIRTHDAY PROVOID DEVELOPER! ‚ú®</span>
        <a href="#" class="donate-btn">üéÅ SEND A GIFT</a>
    </div>

    <div id="tab-bar">
        <div id="new-tab-btn">+</div>
    </div>
    
    <div id="container"></div>
    <div class="toast-container" id="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>
    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs' } });

        let editor, activeTab = null, tabs = [];

        function celebrate() {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#ffd700', '#ffffff', '#ff0000']
            });
        }

        function checkBirthday() {
            const now = new Date();
            const banner = document.getElementById('birthday-banner');
            const isJanuary = now.getMonth() === 0;
            const isBirthdayDay = (now.getDate() === 18 || now.getDate() === 19);

            if (isJanuary && isBirthdayDay) {
                banner.style.display = 'flex';
                setTimeout(celebrate, 1500);
            }
        }

        function notify(msg, tag = "INFO") {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<span style="opacity:0.5; font-weight:bold; margin-right:8px">${tag}</span> ${msg}`;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 50);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 4000);
        }

        function createTab(name = null, content = '-- ProVoid Script', isNew = true) {
            let finalName = name;
            if (!finalName) {
                let i = 1;
                const currentNames = tabs.map(t => t.name);
                while (currentNames.includes(`Script ${i}`)) { i++; }
                finalName = `Script ${i}`;
            }

            const tab = {
                id: Math.random().toString(36).substr(2, 9),
                name: finalName,
                content: content,
                element: document.createElement('div')
            };

            tab.element.className = 'tab';
            tab.element.innerHTML = `<span class="tab-lbl">${tab.name}</span><span class="tab-close">√ó</span>`;
            
            tab.element.onclick = () => activateTab(tab);
            
            tab.element.ondblclick = (e) => {
                e.stopPropagation();
                const lbl = tab.element.querySelector('.tab-lbl');
                const input = document.createElement('input');
                input.style.cssText = "background:#111; border:1px solid #333; color:#fff; width:100%; outline:none; font-family:inherit; font-size:12px; padding:2px;";
                input.value = tab.name;
                lbl.replaceWith(input);
                input.focus();
                input.select();
                const finishRename = () => {
                    tab.name = input.value.trim() || tab.name;
                    const newLbl = document.createElement('span');
                    newLbl.className = "tab-lbl";
                    newLbl.innerText = tab.name;
                    input.replaceWith(newLbl);
                    saveTabs();
                };
                input.onblur = finishRename;
                input.onkeydown = (k) => { if(k.key === 'Enter') finishRename(); };
            };

            tab.element.querySelector('.tab-close').onclick = (ev) => {
                ev.stopPropagation();
                closeTab(tab.id);
            };

            const btn = document.getElementById('new-tab-btn');
            document.getElementById('tab-bar').insertBefore(tab.element, btn);
            tabs.push(tab);

            if (isNew) activateTab(tab);
            return tab;
        }

        function activateTab(tab) {
            if (activeTab) {
                activeTab.content = editor.getValue();
                activeTab.element.classList.remove('active');
            }
            activeTab = tab;
            tab.element.classList.add('active');
            tab.element.classList.remove('dirty'); 
            if (editor) editor.setValue(tab.content);
            saveTabs();
        }

        function closeTab(id) {
            if (tabs.length <= 1) return notify("Cannot close last tab", "SYSTEM");
            const idx = tabs.findIndex(t => t.id === id);
            tabs[idx].element.remove();
            tabs.splice(idx, 1);
            if (activeTab?.id === id) activateTab(tabs[0]);
            saveTabs();
        }

        function saveTabs() {
            if (!activeTab || !editor) return;
            localStorage.setItem('provoid_tabs_v3', JSON.stringify({
                activeTabId: activeTab.id,
                tabs: tabs.map(t => ({ 
                    id: t.id, 
                    name: t.name, 
                    content: t.id === activeTab.id ? editor.getValue() : t.content 
                }))
            }));
        }

        require(['vs/editor/editor.main'], function() {
            monaco.editor.defineTheme('provoidUltra', {
                base: 'vs-dark', inherit: true,
                rules: [],
                colors: { 'editor.background': '#080808', 'editorCursor.foreground': '#ffd700' }
            });

            editor = monaco.editor.create(document.getElementById('container'), {
                theme: 'provoidUltra',
                language: 'lua',
                fontSize: 14,
                automaticLayout: true,
                cursorBlinking: "expand",
                smoothScrolling: true,
                cursorSmoothCaretAnimation: true,
                minimap: { enabled: false }
            });

            editor.onDidChangeModelContent(() => {
                if (activeTab && !activeTab.element.classList.contains('active')) {
                    activeTab.element.classList.add('dirty');
                }
            });

            const saved = localStorage.getItem('provoid_tabs_v3');
            if (saved) {
                const data = JSON.parse(saved);
                data.tabs.forEach(t => createTab(t.name, t.content, false));
                activateTab(tabs.find(t => t.id === data.activeTabId) || tabs[0]);
            } else {
                createTab(null, '-- ProVoid Lightning v4', false);
            }
            checkBirthday();
        });

        document.getElementById('new-tab-btn').onclick = () => createTab();
    </script>
</body>
</html>
